---
title: MySQL索引
date: 2018-12-15
tags:
 - MySQL
categories:
 - 数据库
---

### 索引

索引：是帮助 MySQL 高效获取数据的 **排好序的数据结构**



### 为什么使用 B+ 树

二叉树：当存储递增序列时会出现树右倾斜的情况，查询效率退化成链表

红黑树：二叉平衡树，其高度不可控，会造成大量的 IO 操作

B+树（B树变种）： 

1. 非叶子节点不存储 data，只存储索引，可以存放更多的索引
2. 叶子节点包含了索引字段
3. 叶子节点通过指针连接，提高区间访问效率

B+数每个节点大小为 16KB，以 BigInt 数据类型为例，一个节点可以存储 1170 个索引，也就是说，三层的 B+ 树可以存储 20 万+ 的数据。



### MyISAM 存储引擎

1. MySQL 使用 .MYI 文件存储索引，使用 .MYD 文件存储数据；
2. MyISAM 存储引擎索引与数据分离，非叶子节点存放索引，叶子节点存放数据地址。



### InnoDB 存储引擎

1. 表数据文件本身是按 B+ 数组织的一个索引结构文件；
2. 主键构成的索引称为做 **聚集索引**，其叶子节点包含了完整的数据记录；
3. 非主键构成的索引称为 **辅助索引**，其叶子节点包含了主键。
4. 数据表必须建立主键。若不建立主键 InnoDB 会自动选择一列唯一索引作为主键，若表中没有建立唯一索引；InnoDB 会自动创建一个隐藏的 rowId字段 作为主键。
5. 推荐使用整形自增主键，整形查询效率比字符串要高，此外自增主键使添加数据操作在节点尾部进行，减小了索引维护代价；
6. 非主键索引结构子节点存储的是主键值，可以有效节省空间，同时保证索引结构的一致性。



### Hash

1. 对索引的 Key 进行一次 hash 运算定位到数据存储的位置；
2. 很多时候 Hash 索引要比 B+ 数更加高效；
3. 仅能满足 “=”、 “IN”，不支持范围索引；
4. 不可避免出现 hash 冲突问题



### 索引选择

叶子节点使用双向指针是为了实现范围查询

![image-20220418134642976](http://image.xiaobailx.top/images/20220418134651.png)

```sql
select * from table where a>5; # 先走索引查询 a = 5，然后返回 a = 5 之后的数据
select * from table where a<5; # 先走索引查询 a = 5，然后返回 a = 5 之前的数据
```



### 回表查询

使用辅助索引进行查询时，需要先查询到对应数据的主键，查询出的主键集合称为回表。